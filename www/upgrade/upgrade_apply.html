<p>{{ @applying_upgrade }} <span id="upgrade-progress">{{ @@progress }}</span></p>

<div id="upgrade-data" data-step="{{ @step }}"></div>

<script type="text/javascript">
    (function ($) {
        var upgrade_callback = function(data) {
            // Error, next or complete
            if (data.status == 'step') {
                // data.progress
                upgrade_apply(data.step);
            } else if (data.status == 'complete') {
                //window.location.href
            }
        }

        var upgrade_apply = function(step) {
            var step_url = 'step';
            $.ajax(step_url, {
                data: { step: step },
                dataType: 'json',
                type: 'POST'
            }).then(upgrade_callback, function (xhr) {
                //xhr.responseJSON
            });
        }

        $(document).ready(function() {
            var step = $('#upgrade-data').data('step');
            upgrade_apply(step);
        });
    })(jQuery);
</script>